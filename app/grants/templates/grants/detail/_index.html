{% comment %}
  Copyright (C) 2020 Gitcoin Core

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU Affero General Public License as published
  by the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
  GNU Affero General Public License for more details.

  You should have received a copy of the GNU Affero General Public License
  along with this program. If not, see <http://www.gnu.org/licenses/>.
{% endcomment %}

{% load static humanize i18n grants_extra compress %}

<!DOCTYPE html>
<html lang="en">

  <head>
    {% include 'shared/head.html' with slim=1 %}
    {% include 'shared/cards_pic.html' %}
    <script src="https://cdn.jsdelivr.net/npm/quill@1.3.6/dist/quill.min.js"></script>
    {% compress css file _grant_details %}
      <link rel="stylesheet" type="text/x-scss" href={% static "v2/scss/grants/new.scss" %} />
      <link rel="stylesheet" type="text/x-scss" href={% static "v2/scss/tabs.scss" %} />
      <link rel="stylesheet" type="text/x-scss" href={% static "v2/scss/tag.scss" %} />
      <link rel="stylesheet" type="text/x-scss" href={% static "v2/scss/activity_stream.scss" %} />
      <link rel="stylesheet" type="text/x-scss" href={% static "v2/scss/grants/side-cart.scss" %} />
      <link rel="stylesheet" type="text/x-scss" href={% static "v2/scss/lib/quill.bubble.scss" %} />
      <link rel="stylesheet" type="text/x-scss" href={% static "v2/scss/lib/quill.snow.scss" %} />
    {% endcompress %}
    <link rel="prefetch" href="/grants/v1/api/grant/{{grant.id}}/" />

  </head>

  <body class="interior {{ active }} grant g-font-muli">
    <div class="content__main min-vh-100 d-md-flex flex-column">
      {% include 'shared/tag_manager_2.html' %}
      <div class="container-fluid header dash px-0">
        {% include 'shared/top_nav.html' with class='d-md-flex' %}
        {% include 'grants/nav.html' %}
      </div>
      {% if is_staff %}
        <div class="alpha-warning font-caption mb-0">
          <span class="font-weight-bold">Staff only</span>
          <a style="color:white;" href="{{grant.admin_url}}">{% trans "View Admin" %}</a>
        </div>
      {% endif %}
      <div class="bg-lightblue pb-5" id="gc-grant-detail"  v-cloak>

        <b-skeleton-wrapper :loading="loading">
          <template #loading>
            <b-row class="mb-4">
              <b-col>
                <b-skeleton-img no-aspect height="290px"></b-skeleton-img>
              </b-col>
            </b-row>
          </b-container>
        </template>
      </b-skeleton-wrapper>
      <div class="" v-if="grant">
        <grant-details :grant="grant" v-if="grant.id">
          <img :src="grant.logo_url" alt="" height="290px" class="d-block w-100 mb-4" style="object-fit: contain; background: black;" :style="grant.image_css">
        </grant-details>
      </div>

        <div id="side-cart" class="grant-side-cart px-5 px-md-4 pb-5 pb-md-0 pt-md-0" style="display: none;">
          {% include 'grants/detail/side-cart.html' %}
        </div>
      </div>
      {% include 'grants/detail/template-grant-details.html' %}

      {% include 'shared/footer.html' %}
      {% include 'shared/current_profile.html' %}
      {% include 'shared/analytics.html' %}
      {% include 'grants/shared/shared_scripts.html' %}
      {% include 'shared/footer_scripts.html' with slim=1 ignore_inject_web3=1 %}
      <script src='https://cdn.jsdelivr.net/npm/quill@1.3.6/dist/quill.min.js'></script>
      <script src='https://cdn.jsdelivr.net/npm/vue-quill-editor@3.0.6/dist/vue-quill-editor.js'></script>
      <script src="{% static "v2/js/lib/quill-image-extend-module.js" %}"></script>

      {{verification_tweet|json_script:"verification_tweet"}}
      {{user_code|json_script:"user_code"}}
      <script>
        var grantDetails = {
                  grant_id: "{{ grant.id }}"
                };
        var user_code = JSON.parse(document.getElementById('user_code').textContent);
        var verification_tweet = JSON.parse(document.getElementById('verification_tweet').textContent);

      </script>

      {% include 'shared/activity_scripts.html' %}
      <script src="{% static "v2/js/status.js" %}"></script>

      <script src="{% static "v2/js/grants/_detail-component.js" %}"></script>
      <script src="{% static "v2/js/grants/_detail.js" %}"></script>
      <script src="{% static "v2/js/grants/funding.js" %}"></script>
      {% if is_team_member %}
        <script src="https://cdn.jsdelivr.net/npm/compressorjs@1.0.6/dist/compressor.min.js"></script>
        {% if tab == 'stats' %}
          <script src="https://www.gstatic.com/charts/loader.js"></script>
          <script src="{% static "v2/js/grants/stats.js" %}"></script>
          <script>
            const max_graph = {{max_graph}};
            const history = {{history|safe}};
          </script>
        {% endif %}
      {% endif %}

      {% if is_staff %}
        <script src='https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.bundle.min.js'></script>
        <script>
          var ctx;
          var checkExist = setInterval(function() {
            if ($('myChart{{forloop.counter0}}').length) {
              ctx = document.getElementById('myChart{{forloop.counter0}}').getContext('2d');
              runGraph();
              clearInterval(checkExist);
            }
          }, 100);
          function runGraph() {
            var myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: [{% for sp in ele.1.0 %}{{sp.0}}, {%endfor%}],
                    datasets: [{
                        label: 'Contributors by Sybil Score',
                        data: [{% for sp in ele.1.0 %}{{sp.1}}, {%endfor%}],
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.2)',
                            'rgba(54, 162, 235, 0.2)',
                            'rgba(255, 206, 86, 0.2)',
                            'rgba(75, 192, 192, 0.2)',
                            'rgba(153, 102, 255, 0.2)',
                            'rgba(255, 159, 64, 0.2)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    title: 'Contributors by Sybil Category',
                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero: true
                            }
                        }]
                    }
                }
            });
          }
        </script>
      {% endif %}

    </div>
  </body>
